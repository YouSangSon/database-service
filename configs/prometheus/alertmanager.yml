global:
  # ì•Œë¦¼ ì¬ì „ì†¡ ê°„ê²©
  resolve_timeout: 5m

  # Slack ì›¹í›… URL (í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì • ê¶Œì¥)
  slack_api_url: '${SLACK_WEBHOOK_URL}'

# ì•Œë¦¼ ë¼ìš°íŒ… ê·œì¹™
route:
  # ê¸°ë³¸ ìˆ˜ì‹ ì
  receiver: 'team-alerts'

  # ê·¸ë£¹í™” ê¸°ì¤€
  group_by: ['alertname', 'cluster', 'service']

  # ì²« ì•Œë¦¼ ì „ì†¡ ëŒ€ê¸° ì‹œê°„
  group_wait: 10s

  # ì¶”ê°€ ì•Œë¦¼ ì „ì†¡ ê°„ê²©
  group_interval: 10s

  # ë™ì¼ ì•Œë¦¼ ì¬ì „ì†¡ ê°„ê²©
  repeat_interval: 12h

  # í•˜ìœ„ ë¼ìš°íŒ… ê·œì¹™
  routes:
    # ì¤‘ìš” ì•Œë¦¼ - ì¦‰ì‹œ ì „ì†¡
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m
      continue: true

    # ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ì•Œë¦¼
    - match:
        service: database
      receiver: 'database-team'
      group_interval: 5m

    # ì„±ëŠ¥ ê´€ë ¨ ì•Œë¦¼
    - match:
        type: performance
      receiver: 'performance-team'
      group_interval: 15m

    # ë³´ì•ˆ ê´€ë ¨ ì•Œë¦¼
    - match:
        type: security
      receiver: 'security-team'
      group_wait: 0s
      repeat_interval: 1h

# ì•Œë¦¼ ìˆ˜ì‹ ì ì„¤ì •
receivers:
  # ê¸°ë³¸ íŒ€ ì•Œë¦¼
  - name: 'team-alerts'
    slack_configs:
      - channel: '#alerts'
        title: '{{ .GroupLabels.alertname }}'
        text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'
        send_resolved: true

  # ì¤‘ìš” ì•Œë¦¼
  - name: 'critical-alerts'
    slack_configs:
      - channel: '#critical-alerts'
        title: 'ğŸš¨ CRITICAL: {{ .GroupLabels.alertname }}'
        text: |
          *Alert:* {{ .GroupLabels.alertname }}
          *Severity:* {{ .CommonLabels.severity }}
          *Summary:* {{ .CommonAnnotations.summary }}
          *Description:* {{ .CommonAnnotations.description }}
          *Graph:* <{{ .ExternalURL }}|:chart_with_upwards_trend: View in Prometheus>
        send_resolved: true
        color: '{{ if eq .Status "firing" }}danger{{ else }}good{{ end }}'

    # PagerDuty í†µí•© (ì„ íƒì‚¬í•­)
    # pagerduty_configs:
    #   - service_key: '${PAGERDUTY_SERVICE_KEY}'
    #     description: '{{ .CommonAnnotations.summary }}'

    # Email ì•Œë¦¼ (ì„ íƒì‚¬í•­)
    email_configs:
      - to: 'oncall@example.com'
        from: 'alertmanager@example.com'
        smarthost: 'smtp.gmail.com:587'
        auth_username: '${SMTP_USERNAME}'
        auth_password: '${SMTP_PASSWORD}'
        headers:
          Subject: 'ğŸš¨ CRITICAL ALERT: {{ .GroupLabels.alertname }}'

  # ë°ì´í„°ë² ì´ìŠ¤ íŒ€ ì•Œë¦¼
  - name: 'database-team'
    slack_configs:
      - channel: '#database-alerts'
        title: 'ğŸ’¾ Database Alert: {{ .GroupLabels.alertname }}'
        text: '{{ .CommonAnnotations.description }}'
        send_resolved: true

  # ì„±ëŠ¥ íŒ€ ì•Œë¦¼
  - name: 'performance-team'
    slack_configs:
      - channel: '#performance-alerts'
        title: 'âš¡ Performance Alert: {{ .GroupLabels.alertname }}'
        text: '{{ .CommonAnnotations.description }}'
        send_resolved: true

  # ë³´ì•ˆ íŒ€ ì•Œë¦¼
  - name: 'security-team'
    slack_configs:
      - channel: '#security-alerts'
        title: 'ğŸ”’ Security Alert: {{ .GroupLabels.alertname }}'
        text: '{{ .CommonAnnotations.description }}'
        send_resolved: true
        color: 'warning'

# ì•Œë¦¼ ì–µì œ ê·œì¹™ (Inhibition Rules)
inhibit_rules:
  # ì¤‘ìš” ì•Œë¦¼ì´ ë°œìƒí•˜ë©´ ê²½ê³  ì•Œë¦¼ ì–µì œ
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'cluster', 'service']

  # ì„œë¹„ìŠ¤ ë‹¤ìš´ ì‹œ ì„±ëŠ¥ ì•Œë¦¼ ì–µì œ
  - source_match:
      alertname: 'ServiceDown'
    target_match:
      type: 'performance'
    equal: ['service']

  # ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨ ì‹œ ì¿¼ë¦¬ ì„±ëŠ¥ ì•Œë¦¼ ì–µì œ
  - source_match:
      alertname: 'MongoDBDown'
    target_match:
      alertname: 'SlowQuery'
    equal: ['instance']

# í…œí”Œë¦¿ íŒŒì¼ ê²½ë¡œ
templates:
  - '/etc/alertmanager/templates/*.tmpl'
